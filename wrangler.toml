name = "cf-telegram-bot"
main = "cf/src/index.ts"
compatibility_date = "2026-01-30"
compatibility_flags = ["nodejs_compat"]
preview_urls = false

# Account settings (optional - can be set via CLI or Dashboard)
# account_id = "your-account-id"

# Workers configuration
[vars]
DEBUG_RESTART = "1"
# Non-secret environment variables (secrets should be set via `wrangler secret put`)
# WEBUI_AUTH_TOKEN = "set-via-secret"
# TELEGRAM_BOT_TOKEN = "set-via-secret-or-ui"

# Durable Objects for state management
[durable_objects]
bindings = [{ name = "STATE_STORE", class_name = "StateStore" }]

# Static assets (WebUI)
[assets]
directory = "webui_dist"
binding = "ASSETS"

# R2 storage for file caching
[[r2_buckets]]
binding = "FILE_BUCKET"
bucket_name = "tg-button-cache"

# Durable Objects migrations - use new_sqlite_classes for free plan
[[migrations]]
tag = "v1"
new_sqlite_classes = ["StateStore"]

# Build configuration - runs before deploy
[build]
command = "cd webui && npm install && npm run build"

# Observability (optional)
[observability]
enabled = true
